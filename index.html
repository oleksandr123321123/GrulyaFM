<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#6D78FF" />
  <meta name="description" content="GrulyaFM - Global Radio with 200+ stations from 22 countries" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="/favicon.ico" />
  <title>GrulyaFM - Global Radio</title>
  <style>
    :root{
      --bg: #0b0f14;
      --bg-elev: rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.09);
      --border: rgba(255,255,255,0.10);
      --text: #eef3ff;
      --muted: #a9b2c7;
      --primary: #6D78FF;
      --primary-2: #A06DFF;
      --accent: #FF6B9D;
      --success: #4ECDC4;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --ring: 0 0 0 3px rgba(109,120,255,.18);
      --card-pad: 18px;
      --maxw: 1600px;
    }
    body.light-theme{
      --bg:#f5f7fb; --bg-elev:#ffffff; --glass:#ffffff;
      --border: rgba(0,0,0,.10);
      --text:#1a1f2e; --muted:#667289;
      --shadow:0 10px 30px rgba(0,0,0,.10);
      --ring:0 0 0 3px rgba(109,120,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, system-ui, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 600px at -10% -10%, #13213a 0%, transparent 60%),
        radial-gradient(1000px 600px at 110% -10%, #26153e 0%, transparent 55%),
        radial-gradient(900px 500px at 50% 120%, #10221f 0%, transparent 60%),
        var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .wrap{max-width:var(--maxw); width:min(100%, 92vw); margin:0 auto; padding:16px; display:grid; gap:16px}
    header.appbar{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,0));
      padding: 10px 0 6px;
    }
    .toolbar{ display:flex; align-items:center; gap:10px; justify-content:space-between; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px; }
    .brand .logo{
      width:40px; height:40px; border-radius:12px;
      display:grid; place-items:center; font-size:22px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      box-shadow: 0 6px 18px rgba(109,120,255,.4);
      transform: translateZ(0);
    }
    .brand .title{font-size:20px}
    #subtitle{color:var(--muted); font-size:13px; margin-top:-3px}
    .searchbar{ display:flex; align-items:center; gap:10px; flex:1; max-width:clamp(320px, 32vw, 720px); margin:0 12px; }
    .searchbar input{
      width:100%; padding:12px 14px 12px 16px; border-radius:12px; border:1.5px solid var(--border);
      background: var(--bg-elev); color:var(--text); font-size:15px; outline:none; transition:.25s;
      box-shadow: inset 0 -1px 0 rgba(255,255,255,.03);
    }
    .searchbar input:focus{border-color:var(--primary); box-shadow: var(--ring)}
    .icon-btn{
      display:grid; place-items:center; border-radius:12px; width:clamp(36px, 4.5vw, 44px); height:clamp(36px, 4.5vw, 44px); border:1.5px solid var(--border);
      background: var(--glass); color:var(--text); font-size:clamp(16px, 1.6vw, 20px); cursor:pointer; transition:.2s;
    }
    .icon-btn:hover{transform:translateY(-2px); border-color:var(--primary); box-shadow:0 8px 18px rgba(0,0,0,.25)}
    .hero{
      display:grid; gap:12px; border:1.5px solid var(--border); border-radius:20px; padding:18px; background: linear-gradient(135deg, rgba(109,120,255,.15), rgba(255,107,157,.12));
      box-shadow: var(--shadow);
    }
    /* Random button: full-width on mobile, content-width on larger screens */
    @media (min-width:480px){
      #randomBtn{ width:auto; max-width:100%; align-self:start; }
      .hero .btn{ font-size: clamp(14px, 1vw + 12px, 16px); }
    }
    #bannerTitle{font-weight:800; font-size: clamp(18px, 2.2vw + 10px, 28px)}
    #bannerText{color:rgba(255,255,255,.9); font-size: clamp(13px, 1.4vw + 8px, 18px)}
    @media (prefers-color-scheme: light){ #bannerText{color:#334} }

    /* Layout */
    .grid{ display:grid; gap:16px; grid-template-columns: 1fr; align-items: start; }
    /* Fluid columns across devices */
    @media (min-width:600px){ .grid{ grid-template-columns: minmax(260px, 34vw) 1fr } }
    @media (min-width:1440px){ .grid{ grid-template-columns: 480px 1fr } }
    /* Ensure stations container doesn't overflow */
    .grid > section{ min-width: 0; overflow: hidden; }
    .card{ background: var(--glass); border:1.5px solid var(--border); border-radius:20px; padding:var(--card-pad); box-shadow: var(--shadow); }

    /* Player */
    .player{ align-self: start; height:auto; }
    @media (min-width:1024px){ .player{ position: sticky; top: 90px; } }
    .player .top{ display:grid; gap:8px; text-align:center; margin-bottom:12px; }
    #stationName{font-size: clamp(18px, 1.2vw + 14px, 22px); font-weight:800}
    #trackMetadata{color:var(--muted); font-size:13px}
    #visualizer{ height:64px; display:flex; align-items:flex-end; justify-content:center; gap:4px; margin:8px 0 12px; }
    #visualizer .bar{ width:5px; height:20%; border-radius:6px; background: linear-gradient(180deg, var(--accent), var(--primary-2)); transition: height .12s ease; }
    .controls{display:flex; align-items:center; justify-content:center; gap:12px; margin:4px 0 12px}
    .btn-circle{
      width:clamp(48px, 7vw, 60px); height:clamp(48px, 7vw, 60px); border-radius:50%; border:none; cursor:pointer; display:grid; place-items:center; font-size:clamp(18px, 2vw, 22px);
      background: linear-gradient(180deg, var(--primary), var(--primary-2)); color:white; box-shadow: 0 8px 22px rgba(109,120,255,.45); transition:.18s;
    }
    .btn-circle.sm{width:clamp(42px, 6vw, 52px); height:clamp(42px, 6vw, 52px); background: var(--bg-elev); color:var(--text); border:1.5px solid var(--border); box-shadow:none}
    .btn-circle:hover{transform: translateY(-2px) scale(1.02)}
    .volume{ display:flex; align-items:center; gap:10px; margin-top:8px; }
    .slider{flex:1; height:10px; background: rgba(255,255,255,.08); border-radius:14px; cursor:pointer; position:relative; overflow:hidden; border:1px solid var(--border)}
    #volumeFill{height:100%; width:70%; background: linear-gradient(90deg, var(--primary), var(--accent))}

    /* Tabs + stations */
    .tabs{ display:flex; gap:8px; overflow-x:auto; overflow-y:hidden; padding:4px 2px; scroll-behavior:smooth; -webkit-overflow-scrolling: touch; }
    .tabs::-webkit-scrollbar{ height: 6px; }
    .tabs::-webkit-scrollbar-track{ background: var(--bg-elev); border-radius: 3px; }
    .tabs::-webkit-scrollbar-thumb{ background: var(--primary); border-radius: 3px; }
    .tab{ border:1.5px solid var(--border); background: var(--bg-elev); color:var(--muted); padding:10px 14px; border-radius:999px; font-weight:700; font-size:13px; cursor:pointer; white-space:nowrap; transition:.18s; flex-shrink: 0; }
    .tab.active{background: linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; border-color:transparent; box-shadow:0 6px 18px rgba(109,120,255,.35)}
    .stations{display:flex; flex-direction:column; gap:10px; max-width: 100%; overflow: visible; padding-bottom: 180px;}
    /* На мобильных устройствах увеличиваем отступ снизу из-за мини-плеера и dock */
    @media (max-width: 640px) {
      .stations{ padding-bottom: 200px; }
    }
    .station-card{
      display:flex; align-items:center; gap:14px; padding:12px;
      border:1.5px solid var(--border); border-radius:16px; background: var(--bg-elev);
      cursor:pointer; transition:.18s;
      max-width: 100%;
      box-sizing: border-box;
    }
    .station-card:hover{transform: translateX(4px); border-color:var(--primary)}
    .station-card.playing{background: linear-gradient(135deg, rgba(109,120,255,.16), rgba(255,107,157,.16)); border-color:var(--primary)}
    .station-icon{font-size:28px; min-width:34px; width:34px; text-align:center; flex-shrink: 0;}
    .station-details{flex:1; min-width:0; overflow: hidden;}
    .station-title{font-weight:800; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .station-country{color:var(--muted); font-size:12px; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .fav-btn{ background:none; border:none; font-size:clamp(18px, 2.2vw, 22px); cursor:pointer; transition:.18s; width:clamp(36px, 5vw, 44px); height:clamp(36px, 5vw, 44px); border-radius:12px; flex-shrink: 0; }
    .fav-btn:hover{transform: scale(1.12)}
    .delete-btn{ background:none; border:1.5px solid var(--border); font-size:clamp(14px, 1.6vw, 16px); cursor:pointer; opacity:.8; width:clamp(36px, 5vw, 44px); height:clamp(36px, 5vw, 44px); border-radius:12px; display:grid; place-items:center; flex-shrink: 0; }
    .delete-btn:hover{opacity:1; transform:scale(1.05); border-color:var(--accent)}
    .station-card.compact{padding:8px 10px !important; border-radius:12px !important}
    .station-card.compact .station-icon{font-size:20px !important}
    .station-card.compact .station-title{font-size:14px !important; font-weight:700}
    .station-card.compact .station-country{font-size:11px !important; opacity:.8}
    .station-card.compact .fav-btn{font-size:18px !important; width:34px; height:34px}

    /* Alarm & Timer pills */
    .pill{display:none}
    .pill.active{display:block}
    #alarmDisplay{border:1.5px dashed var(--success); background: linear-gradient(120deg, rgba(78,205,196,.12), rgba(109,120,255,.10)); border-radius:16px; padding:12px}
    #alarmText{font-weight:800}
    #alarmDays{color:var(--muted); font-size:12px}
    #timerDisplay{border:1.5px dashed #9b87f5; background: linear-gradient(120deg, rgba(155,135,245,.12), rgba(120,200,255,.10)); border-radius:16px; padding:12px}
    #timerText{font-weight:800}
    #timerRemaining{color:var(--muted); font-size:12px}

    /* Modals */
    .modal{position:fixed; inset:0; display:none; place-items:center; z-index:50; backdrop-filter: blur(8px); background: rgba(0,0,0,.45)}
    .modal.active{display:grid}
    .mcard{
      width:min(480px, 92vw); max-height:84vh; overflow:auto;
      background: var(--glass); border:1.5px solid var(--border); border-radius:20px; padding:18px; box-shadow: var(--shadow);
      animation: mshow .18s ease;
    }
    @keyframes mshow{from{transform:translateY(6px); opacity:.6} to{transform:none; opacity:1}}
    .mhead{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .mtitle{font-weight:900}
    .x{width:clamp(36px, 5vw, 44px); height:clamp(36px, 5vw, 44px); display:grid; place-items:center; border-radius:12px; border:1.5px solid var(--border); background:var(--bg-elev); cursor:pointer}
    .set-sec{margin:14px 0}
    .sec-title{color:var(--muted); font-weight:800; margin-bottom:8px}
    .lang-grid{display:grid; grid-template-columns: repeat(2, 1fr); gap:10px}
    .lang-item{border:1.5px solid var(--border); border-radius:12px; padding:12px; text-align:center; cursor:pointer; background:var(--bg-elev)}
    .lang-item.active{background: linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; border-color:transparent}
    .set-item{display:flex; align-items:center; justify-content:space-between; padding:12px 0; border-bottom:1px dashed var(--border)}
    .checkbox{width:24px; height:24px; border:1.5px solid var(--border); border-radius:8px; display:grid; place-items:center}
    .checkbox.checked{background:var(--primary); border-color:transparent; color:#fff; font-weight:900}
    .input{margin:10px 0}
    label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px}
    .field{width:100%; border:1.5px solid var(--border); background:var(--bg-elev); color:var(--text); border-radius:12px; padding:12px; outline:none}
    .field:focus{border-color:var(--primary); box-shadow: var(--ring)}
    .btn{
      width:100%; height:clamp(44px, 5vw, 52px); border:none; border-radius:12px; cursor:pointer;
      background: linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; font-weight:900;
      box-shadow: 0 10px 24px rgba(109,120,255,.35); transition:.18s;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn-ghost{
      width:100%; height:clamp(44px, 5vw, 52px); border:1.5px solid var(--border); border-radius:12px; background:var(--bg-elev); color:var(--text); font-weight:800; margin-top:8px;
    }
    /* On larger screens, default buttons shrink to content width */
    @media (min-width:480px){ .btn{ width:auto } }
    /* Keep full-width buttons inside modals and stacks */
    .modal .btn, .btn-stack .btn{ width:100% }
    .timer-grid{display:grid; grid-template-columns: repeat(2, 1fr); gap:10px}
    .timer-option{border:1.5px solid var(--border); border-radius:12px; padding:16px; text-align:center; background:var(--bg-elev); cursor:pointer}
    .timer-option:hover{border-color:var(--primary)}
    .weekdays{display:grid; grid-template-columns: repeat(7, 1fr); gap:8px}
    .weekday{border:1.5px solid var(--border); border-radius:10px; padding:10px 0; text-align:center; font-size:12px; cursor:pointer; background:var(--bg-elev)}
    .weekday.active{background:var(--primary); color:#fff; border-color:transparent}
    .toast{
      position: fixed; left:50%; bottom:26px; transform:translateX(-50%);
      padding:12px 16px; border-radius:999px; background: var(--bg-elev); border:1.5px solid var(--border); box-shadow: var(--shadow); z-index:60;
      animation: mshow .2s ease;
    }

    /* MINI + dock */
    .mini{
      position: fixed; left:12px; right:12px; bottom:74px; z-index:35;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: var(--glass); border:1.5px solid var(--border); border-radius:16px; padding:10px 12px;
      box-shadow: var(--shadow);
    }
    .mini.hidden{display:none}
    .mp-title{min-width:0}
    #miniTitle{font-weight:800; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    #miniMeta{color:var(--muted); font-size:11px; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .mp-controls{display:flex; align-items:center; gap:8px}
    .mp-btn{ width:clamp(36px, 5vw, 44px); height:clamp(36px, 5vw, 44px); border-radius:12px; border:1.5px solid var(--border); background: var(--bg-elev); color:var(--text); font-size:clamp(14px, 1.8vw, 18px); cursor:pointer; }
    .mp-btn.main{ background: linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; border-color:transparent; width:clamp(42px, 6vw, 50px); height:clamp(42px, 6vw, 50px); }
    @media (min-width: 641px){ .mini{display:none !important} }
    .mobile-dock{
      position: fixed; left:12px; right:12px; bottom:12px; z-index:30;
      display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;
      background: rgba(0,0,0,.25); backdrop-filter: blur(10px);
      border:1.5px solid var(--border); border-radius:16px; padding:8px;
    }
    .dock-btn{ height:clamp(40px, 6vw, 48px); border-radius:12px; border:1.5px solid var(--border); background: var(--bg-elev); font-size:clamp(16px, 2vw, 20px); cursor:pointer; }
    @media (min-width: 641px){ .mobile-dock{display:none} }

    /* Горизонтальная панель действий */
    .actions-row{ display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap; }
    .action-btn{
      width:clamp(40px, 5.6vw, 48px); height:clamp(40px, 5.6vw, 48px); border-radius:12px;
      border:1.5px solid var(--border);
      background: var(--bg-elev); color: var(--text); font-size:clamp(16px, 2vw, 20px); cursor:pointer;
      transition:.18s;
    }
    .action-btn:hover{ transform: translateY(-2px); border-color: var(--primary); }
    .quick, .quick-vert{ display:none !important; }

    /* Стили для скрытого нативного select (оставим, чтобы JS не ломать) */
    select.field{ display:none; }

    /* === CUSTOM SELECT (glass) === */
    .cselect{
      position: relative;
      user-select: none;
    }
    .cselect-selected{
      width:100%;
      border:1.5px solid var(--border);
      border-radius:12px;
      background: var(--bg-elev);
      color: var(--text);
      padding:12px 40px 12px 14px;
      cursor:pointer;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .cselect-selected:after{
      content:"";
      position:absolute; right:14px; top:50%; transform:translateY(-50%) rotate(45deg);
      width:8px; height:8px; border-right:2px solid var(--text); border-bottom:2px solid var(--text);
      opacity:.8;
    }
    .cselect.open .cselect-selected:after{ transform:translateY(-50%) rotate(-135deg); }
    .cselect-options{
      position:absolute; left:0; right:0; top:calc(100% + 6px);
      max-height:260px; overflow:auto; z-index:70;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      border:1.5px solid var(--border);
      border-radius:14px;
      box-shadow: var(--shadow);
      padding:6px;
      display:none;
    }
    .cselect.open .cselect-options{ display:block; animation:mshow .12s ease; }
    .cselect-option{
      padding:10px 12px; border-radius:10px; cursor:pointer;
      color:var(--text); background: transparent; border:1px solid transparent;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .cselect-option:hover{ background: var(--glass); border-color: var(--border); }
    .cselect-option.active{ background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; color:#fff; }
    .cselect-empty{
      padding:12px; color:var(--muted);
    }
    /* === Themed scrollbars (modal + custom select) ===================== */
/* Цвета через переменные темы */
:root{
  --sb-track: rgba(255,255,255,.07);
  --sb-thumb: linear-gradient(180deg, var(--primary), var(--accent));
  --sb-thumb-plain: rgba(255,255,255,.35);
}
body.light-theme{
  --sb-track: rgba(0,0,0,.08);
  --sb-thumb-plain: rgba(0,0,0,.35);
}

/* Firefox */
.mcard,
.cselect-options{
  scrollbar-width: thin;                     /* тонкий скролл */
  scrollbar-color: var(--primary) var(--sb-track); /* ползунок / трек */
  scrollbar-gutter: stable both-edges;       /* без «дёргания» контента */
}

/* WebKit (Chrome/Edge/Opera/Safari) */
.mcard::-webkit-scrollbar,
.cselect-options::-webkit-scrollbar{
  width: 10px;
  height: 10px;
}

.mcard::-webkit-scrollbar-track,
.cselect-options::-webkit-scrollbar-track{
  background: var(--sb-track);
  border-radius: 10px;
}

.mcard::-webkit-scrollbar-thumb,
.cselect-options::-webkit-scrollbar-thumb{
  background: var(--sb-thumb);
  border-radius: 10px;
  border: 2px solid transparent;         /* акцент на «капсулу» */
  background-clip: padding-box;
  box-shadow: 0 2px 8px rgba(0,0,0,.25);
}

.mcard::-webkit-scrollbar-thumb:hover,
.cselect-options::-webkit-scrollbar-thumb:hover{
  filter: brightness(1.08);
}

/* Скролл полоска чуть тоньше на узких экранах */
@media (max-width:640px){
  .mcard::-webkit-scrollbar,
  .cselect-options::-webkit-scrollbar{ width: 8px; height: 8px; }
}

/* Небольшой внутренний паддинг у списка опций, чтобы не прилипал ползунок */
.cselect-options{
  padding-right: 6px;
}
/* === macOS-like overlay scrollbars ============================== */
/* применяем только там, где видимы скроллы: модалка и список опций */
.mcard,
.cselect-options{
  /* Firefox */
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,.45) transparent;   /* thumb / track */
  scrollbar-gutter: stable both-edges;
}

/* WebKit (Chrome/Edge/Opera/Safari) */
.mcard::-webkit-scrollbar,
.cselect-options::-webkit-scrollbar{
  width: 8px;              /* тонкий, как на macOS */
  height: 8px;
  background: transparent; /* трек «прозрачный» — эффект оверлея */
}

.mcard::-webkit-scrollbar-thumb,
.cselect-options::-webkit-scrollbar-thumb{
  border-radius: 999px;
  background: rgba(255,255,255,.35);   /* тёмная тема: полупрозрачный thumb */
  border: 2px solid transparent;       /* «воздух» вокруг, как в macOS */
  background-clip: padding-box;
  box-shadow: 0 2px 8px rgba(0,0,0,.25); /* мягкая тень — лучше видно */
  transition: background-color .15s ease, box-shadow .15s ease;
}

/* При наведении / фокусе контейнера — чуть толще и контрастнее */
.mcard:hover::-webkit-scrollbar,
.cselect-options:hover::-webkit-scrollbar,
.mcard:focus-within::-webkit-scrollbar,
.cselect-options:focus-within::-webkit-scrollbar{
  width: 11px;
  height: 11px;
}

.mcard:hover::-webkit-scrollbar-thumb,
.cselect-options:hover::-webkit-scrollbar-thumb,
.mcard:focus-within::-webkit-scrollbar-thumb,
.cselect-options:focus-within::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.65);   /* меньше прозрачности = удобнее видно */
  box-shadow: 0 2px 10px rgba(0,0,0,.35);
}

/* Светлая тема — тёмный thumb, как в macOS */
body.light-theme .mcard,
body.light-theme .cselect-options{
  scrollbar-color: rgba(0,0,0,.55) transparent;
}
body.light-theme .mcard::-webkit-scrollbar-thumb,
body.light-theme .cselect-options::-webkit-scrollbar-thumb{
  background: rgba(0,0,0,.40);
  box-shadow: 0 2px 8px rgba(0,0,0,.2);
}
body.light-theme .mcard:hover::-webkit-scrollbar-thumb,
body.light-theme .cselect-options:hover::-webkit-scrollbar-thumb,
body.light-theme .mcard:focus-within::-webkit-scrollbar-thumb,
body.light-theme .cselect-options:focus-within::-webkit-scrollbar-thumb{
  background: rgba(0,0,0,.70);
}

/* небольшой внутренний отступ у списка опций, чтобы палец/ползунок не прилипал */
.cselect-options{ padding-right: 6px; }

/* На очень узких экранах — чуть тоньше */
@media (max-width: 640px){
  .mcard::-webkit-scrollbar,
  .cselect-options::-webkit-scrollbar{ width: 7px; height: 7px; }
}
/* === Account modal polish =================================== */
#accountModal .mcard{
  width:min(520px, 92vw);
  background: var(--glass);
  border:1.5px solid var(--border);
}

#accountModal .input .field{
  background: var(--bg-elev);
  color: var(--text);
  border:1.5px solid var(--border);
  border-radius:12px;
  padding:12px;
}
#accountModal .input .field:focus{
  border-color: var(--primary);
  box-shadow: var(--ring);
  outline: none;
}

/* Убираем белый autofill */
#accountModal input.field:-webkit-autofill{
  -webkit-text-fill-color: var(--text);
  transition: background-color 10000s ease-in-out 0s;
  box-shadow: 0 0 0px 1000px var(--bg-elev) inset;
}

/* Кнопки — отдельные, не «слипшиеся» */
.btn-stack{ display:grid; gap:10px; margin-top:6px; }
.btn{ height:clamp(44px, 5vw, 52px); border-radius:12px; font-weight:900; }
.btn.primary{ background: linear-gradient(135deg, var(--primary), var(--accent)); color:#fff; border:none; }
.btn.ghost-strong{ background: var(--bg-elev); color: var(--text); border:1.5px solid var(--border); }
.btn.link{ background: transparent; border:1.5px dashed var(--border); color: var(--text); }

/* Ховер/фокус для чёткости */
.btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.25); border-color: var(--primary); }
.btn:focus-visible{ outline: none; box-shadow: var(--ring); }

/* Мобильные правки — крупнее зоны клика */
@media (max-width: 420px){
  #accountModal .mcard{ width: min(480px, 94vw); }
  .btn{ height:clamp(44px, 5vw, 52px); }
}

/* Иконка закрытия — чуть контрастнее при ховере */
#accountModal .x:hover{ border-color: var(--primary); transform: translateY(-1px); }

/* === ДОПОЛНИТЕЛЬНАЯ АДАПТИВНОСТЬ ДЛЯ МОБИЛЬНЫХ === */
@media (max-width: 480px) {
  .wrap{ width: 96vw; padding: 12px; }
  .searchbar{ max-width: 100%; margin: 8px 0; }
  .toolbar{ flex-wrap: wrap; }
  .station-card{ gap: 10px; padding: 10px; }
  .station-icon{ font-size: 24px; min-width: 30px; width: 30px; }
  .station-title{ font-size: 14px; }
  .station-country{ font-size: 11px; }
}

@media (max-width: 375px) {
  .wrap{ width: 98vw; padding: 8px; }
  .grid{ gap: 12px; }
  .station-card{ gap: 8px; padding: 8px; }
  .fav-btn, .delete-btn{ width: 32px; height: 32px; font-size: 16px; }
}

/* Убираем горизонтальный скролл на body */
html, body{ overflow-x: hidden; }
body{ max-width: 100vw; }

  </style>
</head>
<body>
  <header class="appbar">
    <div class="wrap" style="padding-bottom:6px">
      <div class="toolbar">
        <div class="brand">
          <div class="logo">📻</div>
          <div>
            <div class="title" style="font-weight:900">GrulyaFM</div>
            <div id="subtitle">Global Radio • 200+ Stations</div>
          </div>
        </div>
        <div class="searchbar">
          <input id="searchInput" type="text" placeholder="Поиск станций..." />
        </div>
        <button id="settingsBtn" class="icon-btn" aria-label="Settings">⚙️</button>
<button id="btnAccount" class="icon-btn" title="Аккаунт">👤</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" aria-label="Banner">
      <div id="bannerTitle">🌍 Глобальное радио</div>
      <div id="bannerText">200+ станций из 22 стран мира</div>
      <button id="randomBtn" class="btn" style="margin-top:6px">
        🎲 <span id="randomBtnText" style="margin-left:8px">Случайная станция</span>
      </button>
    </section>

    <section class="grid">
      <aside class="card player" aria-label="Player">
        <div id="alarmDisplay" class="pill" style="margin-bottom:10px">
          <div id="alarmText">⏰ Будильник: 07:00</div>
          <div id="alarmDays">Пн, Вт, Ср, Чт, Пт</div>
        </div>

        <div id="timerDisplay" class="pill" style="margin-bottom:10px">
          <div id="timerText">💤 Sleep Timer: 15:00</div>
          <div id="timerRemaining" style="color:var(--muted); font-size:12px">Осталось: 15 мин</div>
        </div>

        <div class="top">
          <div id="stationName">Выберите станцию</div>
          <div id="trackMetadata">Нажмите на станцию ниже</div>
        </div>

        <div id="visualizer" aria-hidden="true"></div>

        <div class="controls" role="group" aria-label="Playback">
          <button id="prevBtn" class="btn-circle sm" aria-label="Previous">⏮️</button>
          <button id="playBtn" class="btn-circle" aria-label="Play/Pause">▶️</button>
          <button id="nextBtn" class="btn-circle sm" aria-label="Next">⏭️</button>
        </div>

        <div class="volume" aria-label="Volume">
          <span aria-hidden="true">🔈</span>
          <div id="volumeSlider" class="slider">
            <div id="volumeFill"></div>
          </div>
          <span aria-hidden="true">🔊</span>
        </div>

        <div class="actions-row" aria-label="Quick actions">
          <button id="timerBtn" class="action-btn" title="Sleep Timer">💤</button>
          <button id="alarmBtn" class="action-btn" title="Alarm">⏰</button>
          <button id="addStationBtn" class="action-btn" title="Add Station">➕</button>
        </div>
      </aside>

      <section aria-label="Stations">
        <div id="tabs" class="tabs" style="margin-bottom:10px"></div>
        <div id="stationsList" class="stations"></div>
      </section>
    </section>

    <!-- MINI PLAYER (mobile) -->
    <div id="miniPlayer" class="mini hidden" role="region" aria-label="Mini Player">
      <div class="mp-title">
        <div id="miniTitle">—</div>
        <div id="miniMeta">—</div>
      </div>
      <div class="mp-controls" role="group" aria-label="Playback mini">
        <button id="miniPrev" class="mp-btn" aria-label="Previous">⏮️</button>
        <button id="miniPlay" class="mp-btn main" aria-label="Play/Pause">▶️</button>
        <button id="miniNext" class="mp-btn" aria-label="Next">⏭️</button>
      </div>
    </div>

    <nav class="mobile-dock">
      <button id="dockHome" class="dock-btn" aria-label="All">🏠</button>
      <button id="dockFavorites" class="dock-btn" aria-label="Favorites">❤️</button>
      <button id="dockSettings" class="dock-btn" aria-label="Settings">⚙️</button>
    </nav>
  </main>

    <!-- === SETTINGS MODAL === -->
  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="mcard">
      <div class="mhead">
        <h2 id="settingsTitle" class="mtitle">⚙️ Settings</h2>
        <button id="closeSettings" class="x" aria-label="Close">✕</button>
      </div>

      <div class="set-sec">
        <h4 id="languageTitle" class="sec-title">🌍 Language</h4>
        <div id="languageGrid" class="lang-grid"></div>
      </div>

      <div class="set-sec">
        <h4 id="themeTitle" class="sec-title">🎨 Theme</h4>
        <div id="themeToggle" class="set-item" style="cursor:pointer">
          <span id="themeText">🌙 Dark Mode</span>
          <div class="checkbox checked"></div>
        </div>
      </div>

      <div class="set-sec">
        <div class="sec-title">📄 List</div>
        <div id="compactToggle" class="set-item" style="cursor:pointer">
          <span id="compactText">Compact list</span>
          <div class="checkbox" id="compactCheckbox"></div>
        </div>
      </div>

      <div class="set-sec">
        <h4 id="countriesTitle" class="sec-title">🌎 Visible Countries</h4>
        <div id="countriesSettings"></div>
      </div>

      <div class="divider" style="margin: 10px 0; opacity:.25; border-bottom:1px solid var(--border)"></div>

      <div class="set-sec">
        <button id="btnAbout" class="btn">ℹ️ About / Contact</button>
        <button id="btnPrivacy" class="btn">🛡️ Privacy Policy</button>
      </div>
    </div>
  </div>

  <!-- === ACCOUNT MODAL === -->
  <div id="accountModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="accountTitle">
    <div class="mcard">
      <div class="mhead">
        <h2 id="accountTitle" class="mtitle">👤 Account</h2>
        <button id="closeAccount" class="x" aria-label="Close">✕</button>
      </div>

<!-- Not signed in -->
<div id="authUnsignedIn">
  <div class="input">
    <label>Email</label>
    <input id="authEmail" class="field" type="email" placeholder="you@example.com" autocomplete="email" />
  </div>
  <div class="input">
    <label>Password</label>
    <input id="authPassword" class="field" type="password" placeholder="••••••••" autocomplete="current-password" />
  </div>

  <div class="btn-stack">
    <button id="btnSignIn" class="btn primary">🔓 Sign In</button>
    <button id="btnSignUp" class="btn ghost-strong">➕ Sign Up</button>
    <button id="btnResetPassword" class="btn link">🔑 Forgot password?</button>
  </div>
</div>


      <!-- Signed in -->
      <div id="authSignedIn" style="display:none">
        <p>✅ Signed in as <span id="userEmail"></span></p>
        <div class="btn-row">
          <button id="btnSyncNow" class="btn">🔁 Sync Now</button>
          <button id="btnSignOut" class="btn">🚪 Sign Out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- === ADD STATION MODAL === -->
  <div id="addStationModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addStationTitle">
    <div class="mcard">
      <div class="mhead">
        <h2 id="addStationTitle" class="mtitle">➕ Add Station</h2>
        <button id="closeAddStation" class="x" aria-label="Close">✕</button>
      </div>

      <div class="input">
        <label id="stationNameLabel">Station Name</label>
        <input id="newStationName" class="field" type="text" placeholder="My radio" />
      </div>

      <div class="input">
        <label id="stationUrlLabel">Stream URL</label>
        <input id="newStationUrl" class="field" type="url" placeholder="https://..." />
      </div>

      <button id="saveStation" class="btn">💾 <span id="saveStationText">Save</span></button>
    </div>
  </div>

  <!-- === TIMER MODAL === -->
  <div id="timerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="timerTitle">
    <div class="mcard">
      <div class="mhead">
        <h2 id="timerTitle" class="mtitle">💤 Sleep Timer</h2>
        <button id="closeTimer" class="x" aria-label="Close">✕</button>
      </div>

      <div class="timer-grid">
        <div class="timer-option" data-minutes="15"><div style="font-size:30px;margin-bottom:6px">⏱️</div><div id="timer15">15 <span class="min-label">min</span></div></div>
        <div class="timer-option" data-minutes="30"><div style="font-size:30px;margin-bottom:6px">⏱️</div><div id="timer30">30 <span class="min-label">min</span></div></div>
        <div class="timer-option" data-minutes="45"><div style="font-size:30px;margin-bottom:6px">⏱️</div><div id="timer45">45 <span class="min-label">min</span></div></div>
        <div class="timer-option" data-minutes="60"><div style="font-size:30px;margin-bottom:6px">⏱️</div><div id="timer60">1 <span class="hour-label">h</span></div></div>
        <div class="timer-option" data-minutes="90"><div style="font-size:30px;margin-bottom:6px">⏱️</div><div id="timer90">1.5 <span class="hour-label">h</span></div></div>
        <div class="timer-option" data-minutes="120"><div style="font-size:30px;margin-bottom:6px">⏱️</div><div id="timer120">2 <span class="hour-label">h</span></div></div>
      </div>

      <button id="cancelTimer" class="btn-ghost"><span id="cancelTimerText">❌ Cancel timer</span></button>
    </div>
  </div>

  <!-- === ALARM MODAL === -->
  <div id="alarmModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="alarmModalTitle">
    <div class="mcard">
      <div class="mhead">
        <h2 id="alarmModalTitle" class="mtitle">⏰ Alarm</h2>
        <button id="closeAlarm" class="x" aria-label="Close">✕</button>
      </div>

      <div class="input">
        <label id="alarmTimeLabel">Time</label>
        <input id="alarmTime" class="field" type="time" value="07:00" />
      </div>

      <div class="input">
        <label id="alarmDaysLabel">Days</label>
        <div id="weekdays" class="weekdays"></div>
      </div>

      <div class="input">
        <label id="alarmStationLabel">Station</label>
        <select id="alarmStation" class="field" style="display:none"></select>
        <div id="alarmStationCSelect" class="cselect">
          <div id="csel-selected" class="cselect-selected">—</div>
          <div id="csel-options" class="cselect-options"></div>
        </div>
      </div>

      <button id="setAlarm" class="btn">⏰ <span id="setAlarmText">Set Alarm</span></button>
      <button id="cancelAlarm" class="btn-ghost">❌ <span id="cancelAlarmText">Cancel Alarm</span></button>
    </div>
  </div>

 <!-- === ABOUT MODAL === -->
<div id="aboutModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
  <div class="mcard">
    <div class="mhead">
      <h2 id="aboutTitle" class="mtitle">ℹ️ About GrulyaFM</h2>
      <button id="closeAbout" class="x" aria-label="Close">✕</button>
    </div>

    <p id="aboutLead" style="margin:6px 0 12px; color:var(--muted)"></p>

    <div class="set-sec">
      <div class="sec-title" id="contactTitle">📫 Contact</div>
      <div>
        <a id="aboutEmail" href="mailto:alexandrgreen051@gmail.com" style="font-weight:800;">
          alexandrgreen051@gmail.com
        </a>
      </div>
    </div>

    <div class="set-sec" id="privacySection">
      <div class="sec-title" id="privacyTitle">🔒 Privacy</div>
      <p id="privacyShort" style="margin:4px 0 6px; color:var(--muted)"></p>
      <a id="privacyLink"
         href="privacy-policy.html"
         target="_blank"
         style="font-weight:800; color:var(--primary); text-decoration:none;">
        📄 Privacy Policy
      </a>
    </div>
  </div>
</div>
<!-- ВАЖНО: модалка закрыта. Дальше уже могут идти <audio> и другие модалки -->


  <script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
  
  // Конфигурация Supabase
  const SUPABASE_URL = 'https://tcgkbzvdyyftfzwxjweg.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjZ2tienZkeXlmdGZ6d3hqd2VnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzNTUyNzUsImV4cCI6MjA3NjkzMTI3NX0.CPOEe8boBLQ70cP-Zt3_GtexqN_TC7v1sX9EAexAeqA';
  
  // Создаем клиент Supabase
  window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

  
  <audio id="audio" preload="none" crossorigin="anonymous"></audio>
  <script defer src="app.js"></script>
  <script defer src="auth-lite.js"></script>

  <!-- Временный fix для кнопки Account (удалить после обновления auth-lite.js) -->
  <script>
    // Ждём загрузки DOM
    document.addEventListener('DOMContentLoaded', () => {
      console.log('🔧 Temporary Account button fix loaded');

      // Ждём немного чтобы auth-lite.js загрузился
      setTimeout(() => {
        const btnAccount = document.getElementById('btnAccount');
        const accountModal = document.getElementById('accountModal');
        const closeAccount = document.getElementById('closeAccount');

        console.log('🔍 btnAccount:', btnAccount);
        console.log('🔍 accountModal:', accountModal);

        // Если обработчик уже есть (auth-lite.js загрузился) - ничего не делаем
        if (btnAccount && btnAccount.onclick === null) {
          console.log('⚠️ Adding temporary click handler for Account button');

          btnAccount.addEventListener('click', () => {
            console.log('👤 Account button clicked!');
            if (accountModal) {
              accountModal.classList.add('active');
              console.log('✅ Modal opened');
            } else {
              console.error('❌ Modal not found!');
            }
          });
        } else {
          console.log('✅ Account button handler already exists');
        }

        // Обработчик закрытия
        if (closeAccount && closeAccount.onclick === null) {
          closeAccount.addEventListener('click', () => {
            console.log('✕ Closing Account modal');
            if (accountModal) {
              accountModal.classList.remove('active');
            }
          });
        }

        // Закрытие по клику на фон
        if (accountModal) {
          accountModal.addEventListener('click', (e) => {
            if (e.target === accountModal) {
              accountModal.classList.remove('active');
              console.log('✕ Modal closed by backdrop click');
            }
          });
        }
      }, 500); // Ждём 500мс для загрузки auth-lite.js
    });
  </script>
</body>
</html>
